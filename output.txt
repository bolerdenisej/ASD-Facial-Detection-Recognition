❯ python emotion_classifier.py --epochs 20 --device auto

Loading data...
Loaded 4289 anger images from train set
Loaded 4289 disgust images from train set
Loaded 4289 fear images from train set
Loaded 4289 happy images from train set
Loaded 4289 neutral images from train set
Loaded 4289 sad images from train set
Loaded 4289 surprise images from train set
Loaded 1072 anger images from validation set
Loaded 1072 disgust images from validation set
Loaded 1072 fear images from validation set
Loaded 1072 happy images from validation set
Loaded 1072 neutral images from validation set
Loaded 1072 sad images from validation set
Loaded 1072 surprise images from validation set
Loaded 595 anger images from test set
Loaded 595 disgust images from test set
Loaded 595 fear images from test set
Loaded 595 happy images from test set
Loaded 595 neutral images from test set
Loaded 595 sad images from test set
Loaded 595 surprise images from test set

Data Summary:
  Train:      30023 images
  Validation: 7504 images
  Test:       4165 images

Device: cpu

Training with early stopping (patience=2)...
================================================================================
Epoch 1/20: 100%|██████████████████████████████████████████████| 470/470 [01:48<00:00,  4.32it/s, loss=1.118, acc=42.1%]
Epoch 1/20:
  Train - Loss: 1.5668, Acc: 42.11%
  Val   - Loss: 1.3484, Acc: 54.46%
  ✓ Best model updated (val_loss: 1.3484, val_acc: 54.46%)
--------------------------------------------------------------------------------
Epoch 2/20: 100%|██████████████████████████████████████████████| 470/470 [01:47<00:00,  4.39it/s, loss=1.187, acc=54.1%]
Epoch 2/20:
  Train - Loss: 1.3179, Acc: 54.12%
  Val   - Loss: 1.2012, Acc: 59.43%
  ✓ Best model updated (val_loss: 1.2012, val_acc: 59.43%)
--------------------------------------------------------------------------------
Epoch 3/20: 100%|██████████████████████████████████████████████| 470/470 [01:47<00:00,  4.38it/s, loss=1.038, acc=58.3%]
Epoch 3/20:
  Train - Loss: 1.2340, Acc: 58.31%
  Val   - Loss: 1.1146, Acc: 63.31%
  ✓ Best model updated (val_loss: 1.1146, val_acc: 63.31%)
--------------------------------------------------------------------------------
Epoch 4/20: 100%|██████████████████████████████████████████████| 470/470 [01:48<00:00,  4.33it/s, loss=1.085, acc=61.8%]
Epoch 4/20:
  Train - Loss: 1.1612, Acc: 61.76%
  Val   - Loss: 1.0789, Acc: 65.42%
  ✓ Best model updated (val_loss: 1.0789, val_acc: 65.42%)
--------------------------------------------------------------------------------
Epoch 5/20: 100%|██████████████████████████████████████████████| 470/470 [01:47<00:00,  4.39it/s, loss=1.216, acc=63.6%]
Epoch 5/20:
  Train - Loss: 1.1199, Acc: 63.60%
  Val   - Loss: 1.0236, Acc: 68.42%
  ✓ Best model updated (val_loss: 1.0236, val_acc: 68.42%)
--------------------------------------------------------------------------------
Epoch 6/20: 100%|██████████████████████████████████████████████| 470/470 [01:49<00:00,  4.28it/s, loss=0.537, acc=64.9%]
Epoch 6/20:
  Train - Loss: 1.0941, Acc: 64.93%
  Val   - Loss: 0.9943, Acc: 69.10%
  ✓ Best model updated (val_loss: 0.9943, val_acc: 69.10%)
--------------------------------------------------------------------------------
Epoch 7/20: 100%|██████████████████████████████████████████████| 470/470 [01:47<00:00,  4.38it/s, loss=0.713, acc=66.4%]
Epoch 7/20:
  Train - Loss: 1.0581, Acc: 66.45%
  Val   - Loss: 0.9760, Acc: 70.24%
  ✓ Best model updated (val_loss: 0.9760, val_acc: 70.24%)
--------------------------------------------------------------------------------
Epoch 8/20: 100%|██████████████████████████████████████████████| 470/470 [01:47<00:00,  4.38it/s, loss=1.596, acc=67.7%]
Epoch 8/20:
  Train - Loss: 1.0349, Acc: 67.65%
  Val   - Loss: 0.9795, Acc: 70.16%
  No improvement (1/2)
--------------------------------------------------------------------------------
Epoch 9/20: 100%|██████████████████████████████████████████████| 470/470 [01:48<00:00,  4.35it/s, loss=1.227, acc=69.1%]
Epoch 9/20:
  Train - Loss: 1.0118, Acc: 69.12%
  Val   - Loss: 0.9253, Acc: 72.83%
  ✓ Best model updated (val_loss: 0.9253, val_acc: 72.83%)
--------------------------------------------------------------------------------
Epoch 10/20: 100%|█████████████████████████████████████████████| 470/470 [01:47<00:00,  4.36it/s, loss=1.032, acc=69.7%]
Epoch 10/20:
  Train - Loss: 0.9948, Acc: 69.74%
  Val   - Loss: 0.9230, Acc: 72.40%
  ✓ Best model updated (val_loss: 0.9230, val_acc: 72.83%)
--------------------------------------------------------------------------------
Epoch 11/20: 100%|█████████████████████████████████████████████| 470/470 [01:47<00:00,  4.36it/s, loss=0.760, acc=70.9%]
Epoch 11/20:
  Train - Loss: 0.9754, Acc: 70.90%
  Val   - Loss: 0.8997, Acc: 73.88%
  ✓ Best model updated (val_loss: 0.8997, val_acc: 73.88%)
--------------------------------------------------------------------------------
Epoch 12/20: 100%|█████████████████████████████████████████████| 470/470 [02:39<00:00,  2.95it/s, loss=0.565, acc=71.3%]
Epoch 12/20:
  Train - Loss: 0.9638, Acc: 71.25%
  Val   - Loss: 0.8959, Acc: 74.44%
  ✓ Best model updated (val_loss: 0.8959, val_acc: 74.44%)
--------------------------------------------------------------------------------
Epoch 13/20: 100%|█████████████████████████████████████████████| 470/470 [02:41<00:00,  2.91it/s, loss=1.057, acc=72.2%]
Epoch 13/20:
  Train - Loss: 0.9447, Acc: 72.16%
  Val   - Loss: 0.8716, Acc: 74.91%
  ✓ Best model updated (val_loss: 0.8716, val_acc: 74.91%)
--------------------------------------------------------------------------------
Epoch 14/20: 100%|█████████████████████████████████████████████| 470/470 [02:38<00:00,  2.96it/s, loss=1.077, acc=72.6%]
Epoch 14/20:
  Train - Loss: 0.9378, Acc: 72.61%
  Val   - Loss: 0.8570, Acc: 75.65%
  ✓ Best model updated (val_loss: 0.8570, val_acc: 75.65%)
--------------------------------------------------------------------------------
Epoch 15/20: 100%|█████████████████████████████████████████████| 470/470 [02:37<00:00,  2.99it/s, loss=0.916, acc=73.0%]
Epoch 15/20:
  Train - Loss: 0.9258, Acc: 73.00%
  Val   - Loss: 0.8540, Acc: 75.89%
  ✓ Best model updated (val_loss: 0.8540, val_acc: 75.89%)
--------------------------------------------------------------------------------
Epoch 16/20: 100%|█████████████████████████████████████████████| 470/470 [02:40<00:00,  2.92it/s, loss=0.747, acc=73.4%]
Epoch 16/20:
  Train - Loss: 0.9142, Acc: 73.36%
  Val   - Loss: 0.8418, Acc: 76.23%
  ✓ Best model updated (val_loss: 0.8418, val_acc: 76.23%)
--------------------------------------------------------------------------------
Epoch 17/20: 100%|█████████████████████████████████████████████| 470/470 [02:37<00:00,  2.98it/s, loss=0.714, acc=74.2%]
Epoch 17/20:
  Train - Loss: 0.9021, Acc: 74.21%
  Val   - Loss: 0.8367, Acc: 76.76%
  ✓ Best model updated (val_loss: 0.8367, val_acc: 76.76%)
--------------------------------------------------------------------------------
Epoch 18/20: 100%|█████████████████████████████████████████████| 470/470 [02:38<00:00,  2.97it/s, loss=1.178, acc=74.5%]
Epoch 18/20:
  Train - Loss: 0.8976, Acc: 74.55%
  Val   - Loss: 0.8246, Acc: 77.01%
  ✓ Best model updated (val_loss: 0.8246, val_acc: 77.01%)
--------------------------------------------------------------------------------
Epoch 19/20: 100%|█████████████████████████████████████████████| 470/470 [02:42<00:00,  2.89it/s, loss=0.909, acc=74.8%]
Epoch 19/20:
  Train - Loss: 0.8866, Acc: 74.79%
  Val   - Loss: 0.8258, Acc: 76.87%
  No improvement (1/2)
--------------------------------------------------------------------------------
Epoch 20/20: 100%|█████████████████████████████████████████████| 470/470 [02:36<00:00,  3.00it/s, loss=1.366, acc=75.4%]
Epoch 20/20:
  Train - Loss: 0.8809, Acc: 75.45%
  Val   - Loss: 0.8085, Acc: 78.42%
  ✓ Best model updated (val_loss: 0.8085, val_acc: 78.42%)
--------------------------------------------------------------------------------

Best model restored (val_loss: 0.8085, val_acc: 78.42%)

Training Summary:
  Final train loss: 0.8809, acc: 75.45%
  Final val loss: 0.8085, acc: 78.42%
  Best val loss: 0.8085, acc: 78.42%

================================================================================
Evaluating on test set...
================================================================================

Test accuracy: 84.39%

Per-class accuracy:
  anger     : 93.61% (595 samples)
  disgust   : 87.90% (595 samples)
  fear      : 94.96% (595 samples)
  happy     : 81.34% (595 samples)
  neutral   : 68.24% (595 samples)
  sad       : 71.43% (595 samples)
  surprise  : 93.28% (595 samples)

Confusion Matrix (rows = true, columns = predicted):

[[557  12   3   3   5   6   9]
 [ 20 523   1   5  25   8  13]
 [  8   3 565   0   4   1  14]
 [ 12  20   7 484  40  15  17]
 [ 17  72   4  14 406  61  21]
 [ 11  49   7  18  68 425  17]
 [  6   5  10   3  13   3 555]]

Model saved to emotion_classifier.pth